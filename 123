-- Spawner Control with Bundled Cable and Debug
local monitor = peripheral.wrap("right") -- adjust side if needed
local redstoneSide = "back" -- side with bundled cable

monitor.setTextScale(0.5)
monitor.setBackgroundColor(colors.black)
monitor.clear()

-- button list
local channels = {
  {name="Blaze", color=colors.red},
  {name="Wither", color=colors.gray},
  {name="Creeper", color=colors.green},
  {name="Iron Golem", color=colors.orange},
  {name="Witch", color=colors.purple},
  {name="Piglin", color=colors.yellow},
  {name="Other 1", color=colors.cyan},
  {name="Other 2", color=colors.blue},
  {name="Other 3", color=colors.lime},
  {name="Light", color=colors.white},
}

local states = {}
for i=1, #channels do
  states[i] = false
end

-- button grid layout
local cols = 4
local rows = math.ceil(#channels / cols)
local buttonW, buttonH = 9, 5
local padding = 1

local function drawButton(idx, x, y)
  local ch = channels[idx]
  local active = states[idx]
  local color = active and ch.color or colors.lightGray

  monitor.setBackgroundColor(color)
  for dy=0, buttonH-1 do
    monitor.setCursorPos(x, y+dy)
    monitor.write(string.rep(" ", buttonW))
  end

  -- write label centered
  monitor.setTextColor(colors.black)
  monitor.setCursorPos(x + math.floor((buttonW - #ch.name)/2), y+math.floor(buttonH/2))
  monitor.write(ch.name)
end

local function drawUI()
  monitor.setBackgroundColor(colors.black)
  monitor.clear()

  -- DEBUG HEADER
  monitor.setCursorPos(1,1)
  monitor.setTextColor(colors.white)
  monitor.write("DEBUG: If you see this, text works")

  local startY = 3 -- leave room for debug
  local idx = 1
  for r=0, rows-1 do
    for c=0, cols-1 do
      if idx <= #channels then
        local x = 2 + c*(buttonW+padding)
        local y = startY + r*(buttonH+padding)
        drawButton(idx, x, y)
        idx = idx + 1
      end
    end
  end
end

local function getButtonAt(x, y)
  local startY = 3
  local idx = 1
  for r=0, rows-1 do
    for c=0, cols-1 do
      if idx <= #channels then
        local bx = 2 + c*(buttonW+padding)
        local by = startY + r*(buttonH+padding)
        if x >= bx and x < bx+buttonW and y >= by and y < by+buttonH then
          return idx
        end
        idx = idx + 1
      end
    end
  end
  return nil
end

local function updateOutputs()
  for i,ch in ipairs(channels) do
    redstone.setBundledOutput(redstoneSide,
      (redstone.getBundledOutput(redstoneSide) & ~ch.color) |
      (states[i] and ch.color or 0))
  end
end

-- Initial draw
drawUI()

-- Main loop
while true do
  local event, side, x, y = os.pullEvent("monitor_touch")
  local idx = getButtonAt(x, y)
  if idx then
    states[idx] = not states[idx]
    updateOutputs()
    drawUI()

    -- DEBUG line showing what was pressed
    monitor.setCursorPos(1,2)
    monitor.setBackgroundColor(colors.black)
    monitor.clearLine()
    monitor.setCursorPos(1,2)
    monitor.setTextColor(colors.white)
    monitor.write("Pressed: "..channels[idx].name.." = "..tostring(states[idx]))
  end
end
